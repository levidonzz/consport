{% extends "sport/base.html" %}

{% block content %}
<div class="contest-detail">
    <h2>{{ contest.name }}</h2>
    <p>{{ contest.description }}</p>

    <div class="info">
        <p>Sport: {{ contest.sport.name }}</p>
        <p>Start Date: {{ contest.start_date }}</p>
        <p>End Date: {{ contest.end_date }}</p>
        <p>Max Participants: {{ contest.max_participants }}</p>
    </div>

    <div class="participants">
        <h3>Participants</h3>
        <ul>
            {% for participant in contest.participants.all %}
            <li>
                {{ participant.username }}
                {% if user.username == participant.username %}
                <form action="{% url "sport:unjoin" contest.id %}" method='POST'>
                    {% csrf_token %}
                    <button type='submit'>Unjoin</button>
                </form>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>

    <div>
        {% if user.is_authenticated %}
            {% if user in contest.participants.all %}
                <p>You are already a participant in this contest.</p>
            {% elif contest.participants.count >= contest.max_participants %}
                <p>This contest is already full.</p>
            {% else %}
                <form method="post" action="{% url 'sport:join_contest' contest.id %}">
                    {% csrf_token %}
                    <button type="submit">Join Contest</button>
                </form>
            {% endif %}
        {% else %}
            <p>Please <a href="{% url 'login' %}">log in</a> to join this contest.</p>
        {% endif %}
    </div>
</div>
{% endblock content %}